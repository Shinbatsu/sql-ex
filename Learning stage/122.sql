with cta as( select ID_psg, town_from, town_to, date + time_out as date_out, min(date + time_out) over (partition by Pass_in_trip. ID_psg) mnd, max(date + time_out) over (partition by Pass_in_trip. ID_psg) mxd from Pass_in_trip join Trip on Trip. trip_no = Pass_in_trip. trip_no) select Passenger.name, jta. b_town from ( select cta. ID_psg, cta. town_from as b_town from cta where cta. date_out = cta.mnd) jta join ( select cta. ID_psg, cta. town_to as c_town from cta where cta. date_out = cta.mxd) jtb on jtb. ID_psg = jta. ID_psg join Passenger on Passenger. ID_psg = jta. ID_psg where jta. b_town <> jtb. c_town
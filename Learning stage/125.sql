WITH cta AS(SELECT CASE WHEN ca > ceiling((cc*1.0)/2) THEN cd * 2 ELSE cc - cd + ca END AS crn, 1 AS tt, * FROM (SELECT row_number() over( ORDER BY code) ca, row_number() over( ORDER BY code DESC) cd, count(*) over() cc, 'Laptop' AS TYPE, model, price FROM Laptop) tr UNION SELECT CASE WHEN ca > ceiling((cc*1.0)/2) THEN cd * 2 ELSE cc - cd + ca END AS crn, 2 AS tt, * FROM (SELECT row_number() over( ORDER BY code) ca, row_number() over( ORDER BY code DESC) cd, count(*) over() cc, 'PC' AS TYPE, model, price FROM PC) tr UNION SELECT CASE WHEN ca > ceiling((cc*1.0)/2) THEN cd * 2 ELSE cc - cd + ca END AS crn, 3 AS tt, * FROM (SELECT row_number() over( ORDER BY code) ca, row_number() over( ORDER BY code DESC) cd, count(*) over() cc, 'Printer' AS TYPE, model, price FROM Printer) tr) SELECT row_number() over( ORDER BY cta.crn, cta.tt) id, cta.type, cta.model, cta.price FROM cta ORDER BY crn, cta.tt
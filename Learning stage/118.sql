WITH Pos(P) AS(SELECT Pos.P FROM (SELECT 1 P UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9) Pos) SELECT z.name, datename(YEAR, z. battle_dt) + '-' + CASE WHEN month(z. battle_dt) >= 10 THEN cast(month(z. battle_dt) AS char(2)) ELSE '0' + cast(month(z. battle_dt) AS char(1)) END + CASE WHEN day(z. battle_dt) >= 10 THEN '-' + cast(day(z. battle_dt) AS char(2)) ELSE '-0' + cast(day(z. battle_dt) AS char(1)) END AS battle_dt, datename(YEAR, z. election_date) + '-' + CASE WHEN month(z. election_date) >= 10 THEN cast(month(z. election_date) AS char(2)) ELSE '0' + cast(month(z. election_date) AS char(1)) END + CASE WHEN day(z. election_date) >= 10 THEN '-' + cast(day(z. election_date) AS char(2)) ELSE '-0' + cast(day(z. election_date) AS char(1)) END AS election_date FROM (SELECT B.name, B.date AS battle_dt, (SELECT min(dateadd(dd, Pos.P,  z2. nY_date)) AS min_P_date FROM (SELECT DISTINCT CASE WHEN Pos.P - 1 = 0 AND month(z.date) > 4 THEN dateadd(YEAR, 1, (cast((datename(YEAR, z.date) + '-04-01') AS datetime))) WHEN Pos.P - 1 = 0 AND month(z.date) < 4 THEN (cast((datename(YEAR, z.date) + '-04-01') AS datetime)) WHEN Pos.P - 1 = 0 AND month(z.date) = 4 THEN z.date ELSE dateadd(YEAR, Pos.P - 1, (cast((datename(YEAR, z.date) + '-04-01') AS datetime))) END AS nY_date FROM (SELECT DISTINCT date FROM Battles WHERE date = B.date) z, Pos)  z2, Pos WHERE ((datepart(YEAR, dateadd(dd, Pos.P,  z2. nY_date)) % 4 = 0 AND datepart(YEAR, dateadd(dd, Pos.P,  z2. nY_date)) % 100 > 0) OR (datepart(YEAR, dateadd(dd, Pos.P,  z2. nY_date)) % 100 = 0 AND datepart(YEAR, dateadd(dd, Pos.P,  z2. nY_date)) % 400 = 0)) AND month(dateadd(dd, Pos.P,  z2. nY_date)) = 4 AND datepart(dw, dateadd(dd, Pos.P,  z2. nY_date)) = 2 + (8 - @@DATEFIRST) % 7 AND month(dateadd(dd, Pos.P - 1,  z2. nY_date)) = 4 AND day(dateadd(dd, Pos.P - 1,  z2. nY_date)) <= 8) election_date FROM Battles B) z;
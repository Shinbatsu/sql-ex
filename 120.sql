SELECT coalesce(c.name, 'TOTAL'), A_mean, G_mean, Q_mean, H_mean FROM(SELECT ID_Comp, convert(numeric(18, 2), avg(atime)) A_mean, convert(numeric(18, 2), Exp(avg(Log(atime)))) G_mean, convert(numeric(18, 2), sqrt(avg(atime*atime))) Q_mean, convert(numeric(18, 2), count(*)/sum(1/atime)) H_mean FROM (SELECT ID_Comp, trip_no, iif(atime < 0, 1440 + atime, atime) AS atime FROM (SELECT company.ID_Comp, trip_no, DATEDIFF(MINUTE, time_out, time_in) * 1.00 AS atime FROM company INNER JOIN trip ON company.ID_comp = trip.ID_comp) AS t1) AS t2 INNER JOIN (SELECT trip_no FROM Pass_in_trip GROUP BY trip_no, date) pt ON t2.trip_no = pt.trip_no GROUP BY ID_Comp WITH CUBE) AS a LEFT JOIN Company c ON a.ID_comp = c.ID_comp